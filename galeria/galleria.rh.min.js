(function($){Galleria.addTheme({name:"RH",author:"Galleria",css:"galleria.rh.css",defaults:{transition:"pulse",thumbCrop:"width",imageCrop:false,carousel:false,show:false,easing:"galleriaOut",fullscreenDoubleTap:false,trueFullscreen:false,_webkitCursor:false,_animate:true},init:function(options){Galleria.requires(1.28,"This version of RH theme requires Galleria version 1.2.8 or later");this.addElement("preloader","loaded","close").append({container:"preloader",preloader:"loaded",stage:"close"});var self=this,stage=this.$("stage"),thumbnails=this.$("thumbnails"),images=this.$("images"),info=this.$("info"),loader=this.$("loader"),target=this.$("target"),len=0,width=target.width(),colWidth=0,active=options.show,HASH=window.location.hash.substr(2),adjustInfo=function(width){self.$("info").css({left:Math.max(20,$(window).width()/2-width/2+10),marginBottom:self.getData().video?40:0})},mi=function(arr){return Math.min.apply(window,arr)},ma=function(arr){return Math.max.apply(window,arr)},masonry=function(elem,options){options=$.extend({speed:400,width:190,onbrick:function(){},onheight:function(){},delay:0,debug:false},options);elem=$(elem);var bricks=elem.children(),width=elem.width(),colCount=Math.floor(width/options.width),colHeight=[],i,thisCol,sz,mH,css={"float":"none",position:"absolute",display:Galleria.SAFARI?"inline-block":"block"};if(elem.data("colCount")===colCount){return}elem.data("colCount",colCount);if(!bricks.length){return}for(i=0;i<colCount;i++){colHeight[i]=0}elem.css("position","relative");bricks.css(css).each(function(j,brick){brick=$(brick);for(i=colCount-1;i>-1;i--){if(colHeight[i]===mi(colHeight)){thisCol=i}}sz={top:colHeight[thisCol],left:options.width*thisCol};if(typeof sz.top!=="number"||typeof sz.left!=="number"){return}if(options.speed){window.setTimeout(function(brick,options,sz){return function(e){Galleria.utils.animate(brick,sz,{easing:"galleriaOut",duration:options.speed,complete:options.onbrick})}}(brick,options,sz),j*options.delay)}else{brick.css(sz);options.onbrick.call(brick)}if(!brick.data("height")){brick.data("height",brick.outerHeight(true))}colHeight[thisCol]+=brick.data("height")});mH=ma(colHeight);if(mH<0){return}if(typeof mH!=="number"){return}if(options.speed){elem.animate({height:ma(colHeight)},options.speed,options.onheight)}else{elem.height(ma(colHeight));options.onheight.call(elem)}};this.bind("fullscreen_enter",function(e){this.$("container").css("height","100%")});this.bind("fullscreen_exit",function(e){if(this.getData().iframe){$(this._controls.getActive().container).find("iframe").remove();this.$("container").removeClass("iframe")}info.hide();$(self._controls.getActive().container).hide();thumbnails.css("left",0);stage.css("left",-1e4)});this.bind("loadstart",function(e){if(Galleria.TOUCH){this.$("image-nav").toggle(!!e.galleriaData.iframe)}});this.bind("thumbnail",function(e){this.addElement("plus");var thumb=e.thumbTarget,plus=this.$("plus").css({display:"block"}).insertAfter(thumb),parent=$(thumb).parent().data("index",e.index);if(options.showInfo&&this.hasInfo(e.index)){plus.append("<span>"+this.getData(e.index).title+"</span>")}colWidth=colWidth||$(thumb).parent().outerWidth(true);$(thumb).css("opacity",0);parent.unbind(options.thumbEventType);if(Galleria.IE){plus.hide()}else{plus.css("opacity",0)}if(!Galleria.TOUCH){parent.hover(function(){if(Galleria.IE){plus.show()}else{plus.stop().css("opacity",1)}},function(){if(Galleria.IE){plus.hide()}else{plus.stop().animate({opacity:0},300)}})}else{parent.bind("touchstart",function(){plus.css("opacity",1)}).bind("touchend",function(){plus.hide()})}len++;this.$("loaded").css("width",len/this.getDataLength()*100+"%");if(len===this.getDataLength()){this.$("preloader").fadeOut(100);thumbnails.data("colCount",null);masonry(thumbnails,{width:colWidth,speed:options._animate?400:0,onbrick:function(){var el=this,image=$(el).find("img");window.setTimeout(function(image){return function(){Galleria.utils.animate(image,{opacity:1},{duration:options.transition_speed});image.parent().unbind("mouseup click").bind(Galleria.TOUCH?"mouseup":"click",function(){thumbnails.css("left",-1e4);stage.css("left",0);var index=$(this).data("index");self.enterFullscreen(function(){self.show(index)})})}}(image),options._animate?image.parent().data("index")*100:0)},onheight:function(){target.height(thumbnails.height())}})}});this.bind("loadstart",function(e){if(!e.cached){loader.show()}});this.bind("data",function(){len=0});this.bind("loadfinish",function(e){loader.hide();info.hide();if(this.hasInfo()&&options.showInfo&&this.isFullscreen()){info.fadeIn(options.transition?options.transitionSpeed:0)}adjustInfo($(e.imageTarget).width())});if(!Galleria.TOUCH&&!options._webkitCursor){this.addIdleState(this.get("image-nav-left"),{left:-100});this.addIdleState(this.get("image-nav-right"),{right:-100});this.addIdleState(this.get("info"),{opacity:0})}this.$("container").css({width:options.width,height:"auto"});if(options._webkitCursor&&Galleria.WEBKIT&&!Galleria.TOUCH){this.$("image-nav-right,image-nav-left").addClass("cur")}if(Galleria.TOUCH){this.setOptions({transition:"fadeslide",initialTransition:false})}this.$("close").click(function(){self.exitFullscreen()});if(Galleria.History&&HASH){stage.css("left",0);thumbnails.css("left",-1e4);this.$("preloader").hide();this.enterFullscreen(function(){this.show(parseInt(HASH,10))})}$(window).resize(function(){if(self.isFullscreen()){if(self.getActiveImage()){adjustInfo(self.getActiveImage().width)}return}var nw=target.width();if(nw!==width){width=nw;masonry(thumbnails,{width:colWidth,delay:50,debug:true,onheight:function(){target.height(thumbnails.height())}})}})}})})(jQuery);